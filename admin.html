<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم – سهل للخدمات</title>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            font-family: 'Cairo', sans-serif;
            background-color: #f4f4f4;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: #27415d;
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding-top: 20px;
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .sidebar a {
            display: block;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            font-size: 18px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar a:hover,
        .sidebar a.active {
            background-color: #e17c1b;
        }

        /* Content */
        .content {
            margin-left: 260px;
            padding: 25px;
            width: calc(100% - 260px);
        }

        h1 {
            color: #27415d;
            margin-bottom: 20px;
        }

        /* Dashboard Cards */
        .cards {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 220px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .card h3 {
            margin: 0;
            color: #27415d;
        }

        .card p {
            font-size: 28px;
            margin-top: 10px;
            color: #e17c1b;
        }

        /* Orders Table */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        th {
            background-color: #27415d;
            color: white;
        }

        tr.accepted {
            background-color: #d4edda;
        }

        button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Cairo';
        }

        .accept-btn { background-color: #28a745; color: white; }
        .delete-btn { background-color: #dc3545; color: white; }
        .whatsapp-btn { background-color: #25d366; color: white; }

        /* Hidden sections */
        .section { display: none; }
        .section.active { display: block; }
    </style>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getFirestore, collection, getDocs, updateDoc, deleteDoc, doc 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadDashboardStats() {
            const orders = await getDocs(collection(db, "orders"));
            let total = 0, accepted = 0, complaints = 0, reviews = 0;

            orders.forEach(doc => {
                total++;
                if (doc.data().status === "مقبول") accepted++;
            });

            document.getElementById("totalOrders").textContent = total;
            document.getElementById("acceptedOrders").textContent = accepted;
            document.getElementById("complaintsCount").textContent = complaints;
            document.getElementById("reviewsCount").textContent = reviews;
        }

        async function loadOrders() {
            const tableBody = document.getElementById("ordersTableBody");
            tableBody.innerHTML = "";

            const querySnapshot = await getDocs(collection(db, "orders"));

            querySnapshot.forEach(docSnap => {
                const data = docSnap.data();
                const row = document.createElement("tr");

                if (data.status === "مقبول") row.classList.add("accepted");

                row.innerHTML = `
                    <td>${data.name}</td>
                    <td>${data.phone}</td>
                    <td>${data.category}</td>
                    <td>${data.serviceDetails}</td>
                    <td>${data.status}</td>
                    <td>
                        <button class="whatsapp-btn" onclick="sendWhatsApp('${data.phone}', '${data.serviceDetails}')">واتساب</button>
                        <button class="accept-btn" onclick="acceptOrder('${docSnap.id}')">قبول</button>
                        <button class="delete-btn" onclick="deleteOrder('${docSnap.id}')">حذف</button>
                    </td>
                `;

                tableBody.appendChild(row);
            });
        }

        window.sendWhatsApp = function(phone, service) {
            const msg =
`السلام عليكم، معك فريق سهل للخدمات.
بخصوص طلبك:

الخدمة: ${service}
رقم الجوال: ${phone}

نود إبلاغك بأنه تم قبول طلبك وسنتواصل معك لإكمال التفاصيل.`;

            window.open(`https://wa.me/966${phone.slice(1)}?text=${encodeURIComponent(msg)}`, "_blank");
        };

        window.acceptOrder = async function(id) {
            await updateDoc(doc(db, "orders", id), { status: "مقبول" });
            loadOrders();
            loadDashboardStats();
        };

        window.deleteOrder = async function(id) {
            await deleteDoc(doc(db, "orders", id));
            loadOrders();
            loadDashboardStats();
        };

        window.onload = () => {
            loadDashboardStats();
            loadOrders();
        };
    </script>

    <script>
        function showSection(id) {
            document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
            document.getElementById(id).classList.add("active");

            document.querySelectorAll(".sidebar a").forEach(a => a.classList.remove("active"));
            document.getElementById("btn-" + id).classList.add("active");
        }
    </script>

</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>لوحة التحكم</h2>

        <a id="btn-dashboard" class="active" onclick="showSection('dashboard')">الرئيسية</a>
        <a id="btn-orders" onclick="showSection('orders')">الطلبات</a>
        <a id="btn-reviews" onclick="showSection('reviews')">آراء العملاء</a>
        <a id="btn-complaints" onclick="showSection('complaints')">الشكاوي</a>
        <a id="btn-users" onclick="showSection('users')">المستخدمين</a>
        <a id="btn-logout" onclick="alert('تم تسجيل الخروج')">تسجيل خروج</a>
    </div>

    <!-- Content -->
    <div class="content">

        <!-- Dashboard -->
        <div id="dashboard" class="section active">
            <h1>لوحة التحكم</h1>

            <div class="cards">
                <div class="card">
                    <h3>إجمالي الطلبات</h3>
                    <p id="totalOrders">0</p>
                </div>

                <div class="card">
                    <h3>الطلبات المقبولة</h3>
                    <p id="acceptedOrders">0</p>
                </div>

                <div class="card">
                    <h3>الشكاوي</h3>
                    <p id="complaintsCount">0</p>
                </div>

                <div class="card">
                    <h3>آراء العملاء</h3>
                    <p id="reviewsCount">0</p>
                </div>
            </div>
        </div>

        <!-- Orders -->
        <div id="orders" class="section">
            <h1>الطلبات</h1>

            <table>
                <thead>
                    <tr>
                        <th>الاسم</th>
                        <th>الجوال</th>
                        <th>التصنيف</th>
                        <th>الخدمة</th>
                        <th>الحالة</th>
                        <th>إجراءات</th>
                    </tr>
                </thead>
                <tbody id="ordersTableBody"></tbody>
            </table>
        </div>

        <!-- Reviews -->
        <div id="reviews" class="section">
            <h1>آراء العملاء</h1>
            <p>سيتم إضافة هذا القسم لاحقًا.</p>
        </div>

        <!-- Complaints -->
        <div id="complaints" class="section">
            <h1>الشكاوي</h1>
            <p>سيتم إضافة هذا القسم لاحقًا.</p>
        </div>

        <!-- Users -->
        <div id="users" class="section">
            <h1>المستخدمين</h1>
            <p>قسم المستخدمين اختياري ويمكن تطويره لاحقًا.</p>
        </div>

    </div>

</body>
</html>
