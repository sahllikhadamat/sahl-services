<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم – سهل للخدمات</title>
  <style>
    body { font-family: sans-serif; background:#f5f5f5; padding:20px; }
    h1 { text-align:center; }
    .box { background:white; padding:20px; margin:20px 0; border-radius:10px; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { padding:10px; border-bottom:1px solid #ddd; }
    button { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; }
    .delete { background:#e74c3c; color:white; }
    .accept { background:#27ae60; color:white; }
  </style>
</head>

<body>

<h1>لوحة التحكم – سهل للخدمات</h1>

<div class="box">
  <h2>الطلبات</h2>
  <table id="ordersTable">
    <thead>
      <tr>
        <th>الاسم</th>
        <th>الجوال</th>
        <th>الخدمة</th>
        <th>ملاحظة</th>
        <th>الحالة</th>
        <th>إجراءات</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div class="box">
  <h2>آراء العملاء</h2>
  <table id="reviewsTable">
    <thead>
      <tr>
        <th>الاسم</th>
        <th>التقييم</th>
        <th>الرسالة</th>
        <th>إجراءات</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">

  /* -------------------- Firebase -------------------- */

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getFirestore, collection, getDocs, deleteDoc, doc, updateDoc 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBCWMTuFTnCl-XerYIt2uT4Hl_WiyQjEO0",
    authDomain: "sahl-services-94183.firebaseapp.com",
    projectId: "sahl-services-94183",
    storageBucket: "sahl-services-94183.firebasestorage.app",
    messagingSenderId: "926677469615",
    appId: "1:926677469615:web:6ba21a1e73752f5271875a"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  /* -------------------- تحميل الطلبات -------------------- */

  async function loadOrders() {
    const table = document.querySelector("#ordersTable tbody");
    table.innerHTML = "";

    const snapshot = await getDocs(collection(db, "orders"));
    snapshot.forEach((docSnap) => {
      const data = docSnap.data();

      const row = `
        <tr>
          <td>${data.name}</td>
          <td>${data.phone}</td>
          <td>${data.category}</td>
          <td>${data.note || "-"}</td>
          <td>${data.status}</td>
          <td>
            <button class="accept" onclick="acceptOrder('${docSnap.id}')">قبول</button>
            <button class="delete" onclick="deleteOrder('${docSnap.id}')">حذف</button>
          </td>
        </tr>
      `;
      table.innerHTML += row;
    });
  }

  window.acceptOrder = async function(id) {
    await updateDoc(doc(db, "orders", id), { status: "تم القبول" });
    loadOrders();
  };

  window.deleteOrder = async function(id) {
    await deleteDoc(doc(db, "orders", id));
    loadOrders();
  };

  /* -------------------- تحميل التعليقات -------------------- */

  async function loadReviews() {
    const table = document.querySelector("#reviewsTable tbody");
    table.innerHTML = "";

    const snapshot = await getDocs(collection(db, "reviews"));
    snapshot.forEach((docSnap) => {
      const data = docSnap.data();

      const row = `
        <tr>
          <td>${data.name}</td>
          <td>${data.rating}</td>
          <td>${data.message}</td>
          <td>
            <button class="delete" onclick="deleteReview('${docSnap.id}')">حذف</button>
          </td>
        </tr>
      `;
      table.innerHTML += row;
    });
  }

  window.deleteReview = async function(id) {
    await deleteDoc(doc(db, "reviews", id));
    loadReviews();
  };

  /* -------------------- تشغيل الصفحة -------------------- */

  loadOrders();
  loadReviews();

</script>

</body>
</html>
